{% extends 'base.html' %}
{% block title %}Notifica√ß√µes - Perfil{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/perfil.css') }}">
<script src="{{ url_for('static', filename='js/perfil.js') }}"></script>

{% include '_confirm_modal.html' %}

<section class="perfil-main">
  <div class="perfil-wrapper">
    <aside class="perfil-sidebar">
      <nav>
        <ul>
          <li><a href="{{ url_for('autenticacao.perfil') }}" class="{% if request.endpoint == 'autenticacao.perfil' %}ativo{% endif %}">Vis√£o Geral</a></li>
          <li><a href="{{ url_for('autenticacao.perfil_info') }}" class="{% if request.endpoint == 'autenticacao.perfil_info' %}ativo{% endif %}">Informa√ß√µes pessoais</a></li>
          <li><a href="{{ url_for('autenticacao.perfil_foto') }}" class="{% if request.endpoint == 'autenticacao.perfil_foto' %}ativo{% endif %}">Alterar foto</a></li>
          <li><a href="{{ url_for('autenticacao.perfil_seguranca') }}" class="{% if request.endpoint == 'autenticacao.perfil_seguranca' %}ativo{% endif %}">Seguran√ßa</a></li>
          <li><a href="{{ url_for('autenticacao.perfil_notificacoes') }}" class="{% if request.endpoint == 'autenticacao.perfil_notificacoes' %}ativo{% endif %}">Notifica√ß√µes</a></li>
          <li><a href="{{ url_for('autenticacao.perfil_pagamentos') }}" class="{% if request.endpoint == 'autenticacao.perfil_pagamentos' %}ativo{% endif %}">Assinatura & Pagamentos</a></li>
          <li><a href="{{ url_for('autenticacao.logout') }}" data-confirm="Voc√™ tem certeza que deseja sair da sua conta?"id="logout-link">Sair</a></li>
        </ul>
      </nav>
    </aside>

    <div class="perfil-content">

      <div class="perfil-header">
        <div class="perfil-header-inner">
          <div class="perfil-avatar"><i class="fa-solid fa-user"></i></div>
          <div class="perfil-identidade">
            <h1>{{ current_user.nome }}</h1>
            <div class="email">{{ current_user.email }}</div>
          </div>
        </div>
      </div>


      <div class="perfil-body">
        <div class="perfil-container">
          <aside class="col-left">
            {% include 'perfil_left_column.html' %}
          </aside>

          <div class="col-right">
            
            {# --- 1. PREFER√äNCIAS DE NOTIFICA√á√ÉO --- #}
            <div class="card mb-4"> 
              <h3>Prefer√™ncias de Notifica√ß√£o</h3>
              <form id="form-notifs" method="POST" action="{{ url_for('autenticacao.perfil_notificacoes') }}">
                {{ csrf_token() if csrf_token is defined }}

                <div class="form-group">
                  <label class="switch">
                    <input type="checkbox" name="notificacao_vencimento" {% if current_user.notif_vencimento %}checked{% endif %}>
                    <span class="switch-label">Avisar quando prazo de loca√ß√£o estiver quase vencendo</span>
                  </label>
                </div>

                <div class="form-group">
                  <label class="switch">
                    <input type="checkbox" name="notificacao_interesse" {% if current_user.notif_interesse %}checked{% endif %}>
                    <span class="switch-label">Avisar quando algu√©m quiser alugar um ve√≠culo seu</span>
                  </label>
                </div>

                <div class="form-group">
                  <label class="switch">
                    <input type="checkbox" name="notificacao_promos" {% if current_user.notif_promos %}checked{% endif %}>
                    <span class="switch-label">Receber emails promocionais</span>
                  </label>
                </div>

                <div style="display:flex;gap:10px;margin-top:12px;">
                  <button type="submit" id="btn-save-notifs" class="btn btn-primary" data-confirm="Salvar prefer√™ncias de notifica√ß√£o?" style="background-color: #000;">Salvar</button>
                  <a href="{{ url_for('autenticacao.perfil') }}" class="btn btn-secondary">Cancelar</a>
                </div>
              </form>
            </div>
            
            {# --- 2. LISTA DE NOTIFICA√á√ïES (IMPORTADA) --- #}
            <div class="card">
                <h3>üîî Minhas Notifica√ß√µes</h3>
                <p class="text-muted">Veja os alertas e avisos sobre suas atividades e loca√ß√µes.</p>
                
                {% if notificacoes %}
                    <ul class="list-group list-group-flush">
                        {% for n in notificacoes %}
                            {# Define a classe do badge com base no tipo para visualiza√ß√£o (Assumindo bootstrap/cores customizadas) #}
                            {% set badge_class = {
                                'ALERTA': 'danger', 
                                'AVISO': 'warning', 
                                'SUCESSO': 'success', 
                                'INFO': 'info'
                            }.get(n.TipoNotificacao|upper, 'secondary') %}
                            
                            <li class="list-group-item d-flex justify-content-between align-items-center {% if not n.Lida %}bg-light{% endif %}">
                                <div>
                                    <span class="badge badge-pill badge-{{ badge_class }} mr-2">
                                        {{ n.TipoNotificacao|upper }}
                                    </span>
                                    <strong>{{ n.Titulo }}</strong> 
                                    - {{ n.Mensagem }}
                                    <small class="text-muted d-block mt-1">{{ n.DataNotificacao.strftime('%d/%m/%Y %H:%M') }}</small>
                                </div>
                                {% if not n.Lida %}
                                    {# Aqui voc√™ precisaria de uma rota Flask para marcar como lida #}
                                    <a href="#" class="btn btn-sm btn-outline-primary">Marcar como Lida</a>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <div class="alert alert-info mt-3" role="alert">
                        Voc√™ n√£o tem notifica√ß√µes recentes.
                    </div>
                {% endif %}
            </div>

          </div>

        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}