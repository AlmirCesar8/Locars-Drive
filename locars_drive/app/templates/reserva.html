{% extends 'base.html' %}
{% block title %}Minhas Reservas{% endblock %}

{#
    ==================================================
    BLOCO DE DADOS DE TESTE (MOCK DATA)
    APAGAR AO INTEGRAR COM O BACK-END DO FLASK
    ==================================================
#}
{% set reservas = [
    {
        'id': 1001,
        'status': 'Ativa',
        'categoria': 'Carro (Motorista)',
        'veiculo': 'Renault Kwid Outsider',
        'imagem': 'https://via.placeholder.com/100x70?text=Kwid',
        'retirada': '18/11/2025 às 10:00',
        'devolucao': '19/11/2025 às 10:00',
        'local': 'Av. Paulista, 1000 - SP',
        'total': 360.00,
        'motorista': 'João Silva',
        'avaliacao_pendente': False
    },
    {
        'id': 1002,
        'status': 'Concluída',
        'categoria': 'E-Bike',
        'veiculo': 'Xiaomi Himo C20',
        'imagem': 'https://via.placeholder.com/100x70?text=E-Bike',
        'retirada': '10/11/2025 às 15:00',
        'devolucao': '10/11/2025 às 18:00',
        'local': 'Rua Augusta, 500 - SP',
        'total': 60.00,
        'motorista': 'N/A',
        'avaliacao_pendente': True
    },
    {
        'id': 1003,
        'status': 'Cancelada',
        'categoria': 'Patinete Elétrico',
        'veiculo': 'Ninebot KickScooter',
        'imagem': 'https://via.placeholder.com/100x70?text=Patinete',
        'retirada': '05/11/2025 às 09:00',
        'devolucao': '05/11/2025 às 11:00',
        'local': 'Praça da Sé - SP',
        'total': 40.00,
        'motorista': 'N/A',
        'avaliacao_pendente': False
    }
] %}

{#
    ==================================================
    FIM DO BLOCO DE DADOS DE TESTE
    ==================================================
#}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/reservas.css') }}">

<section class="reservas-main">
    <div class="container">
        <h1>Minhas Reservas</h1>

        <div class="reservas-tabs">
            <button class="tab-button ativo" data-status="Todas">Todas ({{ reservas | length }})</button>
            <button class="tab-button" data-status="Ativa">Ativas ({{ reservas | selectattr('status', 'equalto', 'Ativa') | list | length }})</button>
            <button class="tab-button" data-status="Concluída">Histórico</button>
            <button class="tab-button" data-status="Cancelada">Canceladas</button>
        </div>

        <div class="reservas-lista">
            {% for reserva in reservas %}
            <div class="reserva-card" data-status="{{ reserva.status }}">
                <div class="reserva-header">
                    <span class="reserva-id">Reserva #{{ reserva.id }}</span>
                    <span class="badge-status status-{{ reserva.status | lower }}">{{ reserva.status | upper }}</span>
                </div>

                <div class="reserva-body">
                    <img src="{{ reserva.imagem }}" alt="{{ reserva.veiculo }}" class="reserva-imagem">
                    
                    <div class="reserva-detalhes">
                        <h3>{{ reserva.veiculo }}</h3>
                        <p class="categoria">{{ reserva.categoria }}</p>

                        <div class="info-grupo">
                            <span class="info-item"><i class="fa-solid fa-clock"></i> **Retirada:** {{ reserva.retirada }}</span>
                            <span class="info-item"><i class="fa-solid fa-location-dot"></i> **Local:** {{ reserva.local }}</span>
                            {% if reserva.motorista != 'N/A' %}
                            <span class="info-item"><i class="fa-solid fa-person-military-pointing"></i> **Motorista:** {{ reserva.motorista }}</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="reserva-acoes">
                        <span class="total-reserva">Total: **R$ {{ reserva.total | round(2) }}**</span>
                        
                        {% if reserva.status == 'Ativa' %}
                            <a href="#" class="btn btn-action primary">Gerenciar / Cancelar</a>
                            <a href="#" class="btn btn-action secondary"><i class="fa-solid fa-phone"></i> Suporte</a>
                        {% elif reserva.status == 'Concluída' and reserva.avaliacao_pendente %}
                            <a href="#" class="btn btn-action primary avaliar-btn"><i class="fa-solid fa-star"></i> Avaliar Serviço</a>
                        {% else %}
                            <a href="#" class="btn btn-action secondary">Ver Detalhes</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% else %}
            <div class="nenhuma-reserva">
                <p>Você não tem nenhuma reserva registrada neste momento.</p>
                <a href="{{ url_for('frotas.listar_veiculos') }}" class="btn btn-primary">Começar a Locar</a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tabButtons = document.querySelectorAll('.tab-button');
        const reservaCards = document.querySelectorAll('.reserva-card');

        function filterReservas(status) {
            tabButtons.forEach(btn => btn.classList.remove('ativo'));
            document.querySelector(`.tab-button[data-status="${status}"]`).classList.add('ativo');

            reservaCards.forEach(card => {
                const cardStatus = card.getAttribute('data-status');
                if (status === 'Todas' || cardStatus === status || (status === 'Histórico' && cardStatus === 'Concluída')) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterReservas(button.getAttribute('data-status'));
            });
        });
        
        // Inicializa mostrando todas as reservas
        filterReservas('Todas'); 
    });
</script>

{% endblock %}